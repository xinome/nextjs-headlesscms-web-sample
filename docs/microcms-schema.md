# microCMS スキーマ設計書

## 概要

本ドキュメントでは、Next.js × microCMS サンプルプロジェクトで使用するAPIスキーマの設計を定義します。

## API一覧

- `categories` - カテゴリ管理API
- `posts` - 記事管理API

---

## categories API

### 基本設定

- **API ID**: `categories`
- **表示名**: カテゴリ
- **API種別**: リスト形式

### フィールド定義

| フィールドID | 表示名 | フィールドタイプ | 必須 | 説明 |
|------------|--------|----------------|------|------|
| `name` | カテゴリ名 | テキストフィールド | ✅ | カテゴリの表示名 |
| `slug` | スラッグ | テキストフィールド | ✅ | URL用の識別子（ユニーク） |
| `description` | 説明 | テキストエリア | ❌ | カテゴリの説明文 |
| `order` | 表示順 | 数値 | ❌ | カテゴリの表示順序（小さい順） |
| `isActive` | 有効/無効 | 真偽値 | ❌ | カテゴリの表示/非表示フラグ（デフォルト: true） |

### フィールド詳細設定

#### name（カテゴリ名）
- **フィールドタイプ**: テキストフィールド
- **必須**: ✅
- **最大文字数**: 50文字
- **プレースホルダー**: 例: 技術記事

#### slug（スラッグ）
- **フィールドタイプ**: テキストフィールド
- **必須**: ✅
- **最大文字数**: 100文字
- **バリデーション**: 半角英数字、ハイフン、アンダースコアのみ
- **プレースホルダー**: 例: tech-article
- **注意**: ユニーク制約はmicroCMS側では設定できないため、運用で管理

#### description（説明）
- **フィールドタイプ**: テキストエリア
- **必須**: ❌
- **最大文字数**: 500文字
- **行数**: 3行

#### order（表示順）
- **フィールドタイプ**: 数値
- **必須**: ❌
- **デフォルト値**: 0
- **最小値**: 0
- **最大値**: 9999

#### isActive（有効/無効）
- **フィールドタイプ**: 真偽値
- **必須**: ❌
- **デフォルト値**: true

---

## posts API

### 基本設定

- **API ID**: `posts`
- **表示名**: 記事
- **API種別**: リスト形式

### フィールド定義

| フィールドID | 表示名 | フィールドタイプ | 必須 | 説明 |
|------------|--------|----------------|------|------|
| `title` | タイトル | テキストフィールド | ✅ | 記事のタイトル |
| `slug` | スラッグ | テキストフィールド | ✅ | URL用の識別子（ユニーク） |
| `excerpt` | 抜粋 | テキストエリア | ❌ | 記事の概要・抜粋文 |
| `content` | 本文 | リッチエディタ | ✅ | 記事の本文 |
| `eyecatch` | アイキャッチ画像 | 画像 | ❌ | 記事の代表画像 |
| `category` | カテゴリ | コンテンツ参照（categories） | ✅ | 記事のカテゴリ |
| `tags` | タグ | 複数選択（テキスト） | ❌ | 記事のタグ（カンマ区切り） |
| `status` | 公開状態 | 選択肢 | ❌ | 公開/下書き（デフォルト: 公開） |
| `seoTitle` | SEOタイトル | テキストフィールド | ❌ | SEO用のタイトル（未設定時はtitleを使用） |
| `seoDescription` | SEO説明 | テキストエリア | ❌ | SEO用の説明文 |
| `noindex` | noindex設定 | 真偽値 | ❌ | 検索エンジンにインデックスさせない（デフォルト: false） |

### フィールド詳細設定

#### title（タイトル）
- **フィールドタイプ**: テキストフィールド
- **必須**: ✅
- **最大文字数**: 100文字
- **プレースホルダー**: 例: Next.js入門

#### slug（スラッグ）
- **フィールドタイプ**: テキストフィールド
- **必須**: ✅
- **最大文字数**: 100文字
- **バリデーション**: 半角英数字、ハイフン、アンダースコアのみ
- **プレースホルダー**: 例: nextjs-introduction
- **注意**: ユニーク制約はmicroCMS側では設定できないため、運用で管理

#### excerpt（抜粋）
- **フィールドタイプ**: テキストエリア
- **必須**: ❌
- **最大文字数**: 200文字
- **行数**: 3行

#### content（本文）
- **フィールドタイプ**: リッチエディタ
- **必須**: ✅
- **エディタタイプ**: 新リッチエディタ（推奨）または旧リッチエディタ
- **注意**: HTMLとして出力されるため、Next.js側で適切にレンダリングする

#### eyecatch（アイキャッチ画像）
- **フィールドタイプ**: 画像
- **必須**: ❌
- **画像サイズ**: 推奨 1200x630px（OGP用）
- **対応形式**: JPEG, PNG, WebP
- **最大ファイルサイズ**: 5MB

#### category（カテゴリ）
- **フィールドタイプ**: コンテンツ参照
- **必須**: ✅
- **参照API**: `categories`
- **表示フィールド**: `name`
- **複数選択**: ❌（1つのみ）

#### tags（タグ）
- **フィールドタイプ**: 複数選択（テキスト）
- **必須**: ❌
- **入力方法**: カンマ区切りテキスト、または繰り返しフィールド
- **推奨**: 繰り返しフィールド（テキスト）を使用

#### status（公開状態）
- **フィールドタイプ**: 選択肢
- **必須**: ❌
- **デフォルト値**: `published`（公開）
- **選択肢**:
  - `published` - 公開
  - `draft` - 下書き

#### seoTitle（SEOタイトル）
- **フィールドタイプ**: テキストフィールド
- **必須**: ❌
- **最大文字数**: 60文字（推奨）
- **プレースホルダー**: 未設定時はtitleを使用

#### seoDescription（SEO説明）
- **フィールドタイプ**: テキストエリア
- **必須**: ❌
- **最大文字数**: 160文字（推奨）
- **行数**: 2行

#### noindex（noindex設定）
- **フィールドタイプ**: 真偽値
- **必須**: ❌
- **デフォルト値**: false
- **説明**: trueの場合、`<meta name="robots" content="noindex">`を出力

---

## スキーマ設計の注意点

### slugのユニーク運用

microCMSでは、slugフィールドに自動的なユニーク制約を設定できません。以下の運用ルールを守ってください：

1. **手動での重複チェック**
   - 新しいコンテンツを作成する際、既存のslugと重複していないか確認
   - 特に記事をコピーする際は注意

2. **命名規則の統一**
   - 半角英数字、ハイフン、アンダースコアのみ使用
   - 大文字小文字を区別（推奨: 小文字のみ）
   - 例: `nextjs-introduction`, `category-tech`

3. **変更時の注意**
   - slugを変更するとURLが変わるため、既存のリンクが切れる
   - 変更前に影響範囲を確認

4. **将来的な改善案**
   - Next.js側でslugの重複チェックAPIを実装
   - または、Webhookでslug変更を検知してリダイレクト設定

### リッチエディタの扱い

- リッチエディタの出力はHTML形式
- Next.js側で`dangerouslySetInnerHTML`を使用するか、HTMLパーサーライブラリを使用
- XSS対策を必ず実施

### 参照関係

- `posts.category`は`categories`を参照
- 参照先のカテゴリが削除された場合の挙動を考慮（Next.js側で404処理）

---

## 次のステップ

1. microCMS管理画面で上記スキーマに基づいてAPIを作成
2. サンプルデータを投入
3. Next.js側でAPI連携を実装
