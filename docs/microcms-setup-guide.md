# microCMS 管理画面セットアップ手順書

## 概要

本ドキュメントでは、microCMS管理画面でAPIを作成し、スキーマを設定する手順を説明します。

## 前提条件

- microCMSのアカウントを作成済み
- サービス（プロジェクト）を作成済み

---

## Step 1: categories API の作成

### 1-1. APIの作成

1. microCMS管理画面にログイン
2. 左メニューから「API設定」を選択
3. 「新規API作成」ボタンをクリック
4. 以下の情報を入力：
   - **API ID**: `categories`
   - **表示名**: `カテゴリ`
   - **API種別**: `リスト形式` を選択
5. 「作成」ボタンをクリック

### 1-2. フィールドの追加

#### name（カテゴリ名）

1. 「フィールドを追加」をクリック
2. フィールドタイプで「テキストフィールド」を選択
3. 以下の設定を行う：
   - **フィールドID**: `name`
   - **表示名**: `カテゴリ名`
   - **必須項目**: ✅ チェック
   - **最大文字数**: `50`
   - **プレースホルダー**: `例: 技術記事`
4. 「保存」をクリック

#### slug（スラッグ）

1. 「フィールドを追加」をクリック
2. フィールドタイプで「テキストフィールド」を選択
3. 以下の設定を行う：
   - **フィールドID**: `slug`
   - **表示名**: `スラッグ`
   - **必須項目**: ✅ チェック
   - **最大文字数**: `100`
   - **プレースホルダー**: `例: tech-article`
   - **バリデーション**: 半角英数字、ハイフン、アンダースコアのみ（手動で確認）
4. 「保存」をクリック
5. **重要**: slugはユニークである必要がありますが、microCMS側では自動チェックされません。運用で管理してください。

#### description（説明）

1. 「フィールドを追加」をクリック
2. フィールドタイプで「テキストエリア」を選択
3. 以下の設定を行う：
   - **フィールドID**: `description`
   - **表示名**: `説明`
   - **必須項目**: ❌ チェックしない
   - **最大文字数**: `500`
   - **行数**: `3`
4. 「保存」をクリック

#### order（表示順）

1. 「フィールドを追加」をクリック
2. フィールドタイプで「数値」を選択
3. 以下の設定を行う：
   - **フィールドID**: `order`
   - **表示名**: `表示順`
   - **必須項目**: ❌ チェックしない
   - **デフォルト値**: `0`
   - **最小値**: `0`
   - **最大値**: `9999`
4. 「保存」をクリック

#### isActive（有効/無効）

1. 「フィールドを追加」をクリック
2. フィールドタイプで「真偽値」を選択
3. 以下の設定を行う：
   - **フィールドID**: `isActive`
   - **表示名**: `有効/無効`
   - **必須項目**: ❌ チェックしない
   - **デフォルト値**: `true`（有効）
4. 「保存」をクリック

### 1-3. 一覧表示設定（オプション）

1. API設定画面の「一覧表示設定」タブを開く
2. 一覧に表示するフィールドを選択：
   - `name`（カテゴリ名）
   - `slug`（スラッグ）
   - `order`（表示順）
   - `isActive`（有効/無効）

---

## Step 2: posts API の作成

### 2-1. APIの作成

1. 左メニューから「API設定」を選択
2. 「新規API作成」ボタンをクリック
3. 以下の情報を入力：
   - **API ID**: `posts`
   - **表示名**: `記事`
   - **API種別**: `リスト形式` を選択
4. 「作成」ボタンをクリック

### 2-2. フィールドの追加

#### title（タイトル）

1. 「フィールドを追加」をクリック
2. フィールドタイプで「テキストフィールド」を選択
3. 以下の設定を行う：
   - **フィールドID**: `title`
   - **表示名**: `タイトル`
   - **必須項目**: ✅ チェック
   - **最大文字数**: `100`
   - **プレースホルダー**: `例: Next.js入門`
4. 「保存」をクリック

#### slug（スラッグ）

1. 「フィールドを追加」をクリック
2. フィールドタイプで「テキストフィールド」を選択
3. 以下の設定を行う：
   - **フィールドID**: `slug`
   - **表示名**: `スラッグ`
   - **必須項目**: ✅ チェック
   - **最大文字数**: `100`
   - **プレースホルダー**: `例: nextjs-introduction`
4. 「保存」をクリック
5. **重要**: slugはユニークである必要がありますが、microCMS側では自動チェックされません。運用で管理してください。

#### excerpt（抜粋）

1. 「フィールドを追加」をクリック
2. フィールドタイプで「テキストエリア」を選択
3. 以下の設定を行う：
   - **フィールドID**: `excerpt`
   - **表示名**: `抜粋`
   - **必須項目**: ❌ チェックしない
   - **最大文字数**: `200`
   - **行数**: `3`
4. 「保存」をクリック

#### content（本文）

1. 「フィールドを追加」をクリック
2. フィールドタイプで「リッチエディタ」を選択
3. 以下の設定を行う：
   - **フィールドID**: `content`
   - **表示名**: `本文`
   - **必須項目**: ✅ チェック
   - **エディタタイプ**: 新リッチエディタ（推奨）または旧リッチエディタ
4. 「保存」をクリック

#### eyecatch（アイキャッチ画像）

1. 「フィールドを追加」をクリック
2. フィールドタイプで「画像」を選択
3. 以下の設定を行う：
   - **フィールドID**: `eyecatch`
   - **表示名**: `アイキャッチ画像`
   - **必須項目**: ❌ チェックしない
   - **画像サイズ**: 推奨 1200x630px（OGP用）
4. 「保存」をクリック

#### category（カテゴリ）

1. 「フィールドを追加」をクリック
2. フィールドタイプで「コンテンツ参照」を選択
3. 以下の設定を行う：
   - **フィールドID**: `category`
   - **表示名**: `カテゴリ`
   - **必須項目**: ✅ チェック
   - **参照API**: `categories` を選択
   - **表示フィールド**: `name` を選択
   - **複数選択**: ❌ チェックしない（1つのみ）
4. 「保存」をクリック

#### tags（タグ）

**方法1: 繰り返しフィールドを使用（推奨）**

1. 「フィールドを追加」をクリック
2. フィールドタイプで「繰り返し」を選択
3. 以下の設定を行う：
   - **フィールドID**: `tags`
   - **表示名**: `タグ`
   - **必須項目**: ❌ チェックしない
4. 繰り返しフィールド内に「テキストフィールド」を追加：
   - **フィールドID**: `value`
   - **表示名**: `タグ名`
5. 「保存」をクリック

**方法2: テキストエリアでカンマ区切り（シンプル）**

1. 「フィールドを追加」をクリック
2. フィールドタイプで「テキストエリア」を選択
3. 以下の設定を行う：
   - **フィールドID**: `tags`
   - **表示名**: `タグ（カンマ区切り）`
   - **必須項目**: ❌ チェックしない
   - **プレースホルダー**: `例: Next.js,React,TypeScript`
4. 「保存」をクリック

#### status（公開状態）

1. 「フィールドを追加」をクリック
2. フィールドタイプで「選択肢」を選択
3. 以下の設定を行う：
   - **フィールドID**: `status`
   - **表示名**: `公開状態`
   - **必須項目**: ❌ チェックしない
   - **選択肢の追加**:
     - `published` - 公開
     - `draft` - 下書き
   - **デフォルト値**: `published`
4. 「保存」をクリック

#### seoTitle（SEOタイトル）

1. 「フィールドを追加」をクリック
2. フィールドタイプで「テキストフィールド」を選択
3. 以下の設定を行う：
   - **フィールドID**: `seoTitle`
   - **表示名**: `SEOタイトル`
   - **必須項目**: ❌ チェックしない
   - **最大文字数**: `60`
   - **プレースホルダー**: `未設定時はタイトルを使用`
4. 「保存」をクリック

#### seoDescription（SEO説明）

1. 「フィールドを追加」をクリック
2. フィールドタイプで「テキストエリア」を選択
3. 以下の設定を行う：
   - **フィールドID**: `seoDescription`
   - **表示名**: `SEO説明`
   - **必須項目**: ❌ チェックしない
   - **最大文字数**: `160`
   - **行数**: `2`
4. 「保存」をクリック

#### noindex（noindex設定）

1. 「フィールドを追加」をクリック
2. フィールドタイプで「真偽値」を選択
3. 以下の設定を行う：
   - **フィールドID**: `noindex`
   - **表示名**: `noindex設定`
   - **必須項目**: ❌ チェックしない
   - **デフォルト値**: `false`
4. 「保存」をクリック

### 2-3. 一覧表示設定（オプション）

1. API設定画面の「一覧表示設定」タブを開く
2. 一覧に表示するフィールドを選択：
   - `title`（タイトル）
   - `slug`（スラッグ）
   - `category`（カテゴリ）
   - `status`（公開状態）

---

## Step 3: APIキーの確認

### 3-1. APIキーの取得

1. 左メニューから「API設定」を選択
2. 各API（`categories`, `posts`）の設定画面を開く
3. 「API設定」タブの「APIキー」を確認
4. **重要**: APIキーは機密情報です。`.env.local`に保存し、Gitにコミットしないでください。

### 3-2. エンドポイントの確認

各APIのエンドポイントURLを確認：
- `categories`: `https://[サービスID].microcms.io/api/v1/categories`
- `posts`: `https://[サービスID].microcms.io/api/v1/posts`

---

## Step 4: サンプルデータの投入（オプション）

### 4-1. カテゴリの作成

1. 左メニューから「コンテンツ管理」→「カテゴリ」を選択
2. 「新規作成」をクリック
3. 以下のサンプルデータを作成：

**カテゴリ1**
- カテゴリ名: `技術記事`
- スラッグ: `tech`
- 説明: `技術に関する記事`
- 表示順: `1`
- 有効/無効: `true`

**カテゴリ2**
- カテゴリ名: `お知らせ`
- スラッグ: `news`
- 説明: `お知らせ記事`
- 表示順: `2`
- 有効/無効: `true`

### 4-2. 記事の作成

1. 左メニューから「コンテンツ管理」→「記事」を選択
2. 「新規作成」をクリック
3. 以下のサンプルデータを作成：

**記事1**
- タイトル: `Next.js入門`
- スラッグ: `nextjs-introduction`
- 抜粋: `Next.jsの基本的な使い方を解説します`
- 本文: （リッチエディタで適当な内容を入力）
- カテゴリ: `技術記事` を選択
- 公開状態: `公開`
- SEOタイトル: （未設定）
- SEO説明: （未設定）
- noindex設定: `false`

---

## slugのユニーク運用に関する注意点

### 問題点

microCMSでは、slugフィールドに自動的なユニーク制約を設定できません。そのため、同じslugを持つコンテンツが複数作成される可能性があります。

### 運用ルール

1. **作成時の確認**
   - 新しいコンテンツを作成する際、既存のslugと重複していないか確認
   - 特に記事をコピーする際は注意

2. **命名規則の統一**
   - 半角英数字、ハイフン、アンダースコアのみ使用
   - 大文字小文字を区別（推奨: 小文字のみ）
   - 例: `nextjs-introduction`, `category-tech`

3. **変更時の注意**
   - slugを変更するとURLが変わるため、既存のリンクが切れる
   - 変更前に影響範囲を確認
   - 必要に応じて、Next.js側でリダイレクト設定を実装

4. **将来的な改善案**
   - Next.js側でslugの重複チェックAPIを実装
   - または、Webhookでslug変更を検知してリダイレクト設定

### チェック方法

1. microCMS管理画面で「コンテンツ管理」を開く
2. 一覧表示でslugを確認
3. 重複がないか目視で確認

---

## トラブルシューティング

### よくある問題

**Q: 参照フィールド（category）でカテゴリが選択できない**
- A: `categories` APIが作成されているか確認
- A: 参照APIの設定で`categories`が選択されているか確認

**Q: リッチエディタの内容が正しく表示されない**
- A: Next.js側でHTMLとして適切にレンダリングされているか確認
- A: XSS対策を実施しているか確認

**Q: slugが重複してしまった**
- A: 既存のコンテンツのslugを変更する
- A: または、新しいコンテンツのslugを変更する

---

## 次のステップ

1. 環境変数の設定（`.env.local`にAPIキーを設定）
2. Next.js側でAPI連携を実装
3. データ取得と表示の実装
